# 模写用Webアプリ 仕様書（Spec v0.2）

> **用途**：Claude にそのまま渡す仕様（仕様駆動開発 / SDD）
>
> **重要原則**
> - 実装・設計は本仕様に**従属**する
> - 仕様外の機能追加・独自判断は禁止
> - 不明点があれば**質問**すること（勝手に補完しない）

---

## 1. 目的

模写練習用の **Webアプリ（PWA）** を作成する。実装コストを最小化し、**オフラインで使用可能**であることを最優先とする。

---

## 2. 技術制約（固定）

- Webアプリ（ブラウザ上で動作）
- TypeScript
- HTML Canvas
- **Fabric.js を使用**
- PWA（Service Worker によるオフライン対応）
- クライアント完結（サーバ通信なし）

---

## 3. 対応環境

- iPad Safari
- PWA（ホーム画面に追加可能）

**AC-01**：初回オンライン起動後、機内モードでも起動・操作できること

---

## 4. 画面・構成

- **1画面完結**
- Canvas は **左右2枚・固定レイアウト**
  - 左：参照面（画像表示のみ）
  - 右：描画面（描画可能）
- 参照面・描画面は **同一ピクセルサイズ**

**AC-02**：左右 Canvas の width / height が一致すること

---

## 5. 操作フロー / 機能仕様

### 5.1 画像読み込み

- 対応形式：`jpg / jpeg / png`
- ローカルファイルのみ（サーバ送信なし）
- 参照面に **contain（縦横比保持）** で表示

**AC-03**：読み込んだ画像が参照面に全体表示され、縦横比が保持されること

---

### 5.2 表示レイアウト

- 初期状態：**左右分割表示**
- トグル操作で **分割表示 ⇄ 重ね表示** を切り替え
- 重ね表示は **表示上の合成のみ**
- 描画データは常に描画面に保持

**AC-04**：重ね表示中に描いた線が、分割表示に戻しても保持されること

---

### 5.3 グリッド

- **常時表示**（ON/OFF切替なし）
- 参照面・描画面で **同比率**
- 分割数 `N` を設定で変更可能（整数、例：3〜10）
- 縦横ともに `N` 等分

**AC-05**：`N=4` の場合、縦横4等分のグリッドが表示されること

**AC-06**：左右 Canvas でグリッド線の座標が一致すること

---

### 5.4 描画

- ブラシは **ペンのみ**
- 設定可能項目：**線幅（ペンサイズ）**

**AC-07**：ペンサイズ変更が次のストロークに反映されること

---

### 5.5 消しゴム

- 消しゴムモードを持つ
- 描画面の線を削除できる

**AC-08**：消しゴム操作で描画された線が消えること

---

### 5.6 Undo

- **描画操作のみ** Undo 対象
- 以下は Undo 対象外：
  - 画像読み込み
  - グリッド設定変更
  - 表示切替
- Redo は不要

**実装方式（指定）**
- 描画完了ごとに `canvas.toJSON()` を履歴に保存
- Undo 操作で `loadFromJSON()` により復元
- 描画が無い状態で Undo してもエラーにならないこと

**AC-09**：2本描画後、Undo で1本になること

**AC-10**：さらに Undo で0本になること

**AC-11**：描画が無い状態で Undo してもエラーにならないこと

---

## 6. UI要素（論理）

- 画像読み込みボタン
- ペンサイズ調整（Slider）
- 消しゴム切替
- Undo ボタン
- グリッド分割数設定
- 分割表示／重ね表示 切替

※ UI の配置・装飾は仕様外（実装裁量）

---

## 7. 非機能要件（最小）

- 操作に対する反応が体感的に遅延しないこと
- すべてのデータは端末ローカルのみで扱う

---

## 8. 禁止事項（明示）

- 保存／読込機能
- Redo
- レイヤ管理
- 複数ブラシ・高度ブラシ
- 筆圧・傾き対応
- レイアウト切替 UI の追加
- 仕様外の最適化・拡張

---

## 9. 要求アウトプット（Claude向け）

以下を **TypeScript** で、シンプルさ最優先で提示すること。

1. 最小ファイル構成
2. Fabric.js を用いた Canvas 初期化コード
3. グリッド描画ロジック
4. ペンサイズ変更・消しゴム実装
5. Undo（JSON スナップショット方式）
6. Service Worker（最小構成）

---

## 10. 仕様凍結

- 本 Spec v0.2 は **凍結**
- 実装前に仕様変更が必要な場合は、本ファイルを改訂すること

---

*End of Spec*

