# 模写用Webアプリ 仕様書（Spec v0.2）

> **用途**：Claude にそのまま渡す仕様（仕様駆動開発 / SDD）
>
> **重要原則**
> - 実装・設計は本仕様に**従属**する
> - 仕様外の機能追加・独自判断は禁止
> - 不明点があれば**質問**すること（勝手に補完しない）

---

## 1. 目的

模写練習用の **Webアプリ（PWA）** を作成する。実装コストを最小化し、**オフラインで使用可能**であることを最優先とする。

---

## 2. 編集ルール（Claude向け）

- ファイルの編集・上書き・生成を行う前に、必ず以下を実施すること
  1. 変更内容の要約
  2. 変更差分（どこがどう変わるか）
  3. 影響範囲（他ファイル・仕様への影響）

- ユーザーの明示的な承認（「OK」「反映して」「GO」等）があるまで
  実際のファイル編集を行ってはならない

- 承認がない場合は「確認待ち」で止めること

---

## 3. 技術制約（固定）

- Webアプリ（ブラウザ上で動作）
- TypeScript
- HTML Canvas
- **Fabric.js を使用**
- PWA（Service Worker によるオフライン対応）
- クライアント完結（サーバ通信なし）

---

## 4. 対応環境

- iPad Safari
- PWA（ホーム画面に追加可能）

**AC-01**：初回オンライン起動後、機内モードでも起動・操作できること

---

## 5. 画面・構成

- **1画面完結**
- Canvas は **左右2枚・固定レイアウト**
  - 左：参照面（画像表示のみ）
  - 右：描画面（描画可能）
- 参照面・描画面は **同一ピクセルサイズ**

**AC-02**：左右 Canvas の width / height が一致すること

---

## 6. 操作フロー / 機能仕様

### 6.1 画像読み込み

- 対応形式：`jpg / jpeg / png`
- ローカルファイルのみ（サーバ送信なし）
- 参照面に **contain（縦横比保持）** で表示

**AC-03**：読み込んだ画像が参照面に全体表示され、縦横比が保持されること

---

### 6.2 表示レイアウト

- 初期状態：**左右分割表示**
- トグル操作で **分割表示 ⇄ 重ね表示** を切り替え
- 重ね表示は **表示上の合成のみ**
- 描画データは常に描画面に保持

**AC-04**：重ね表示中に描いた線が、分割表示に戻しても保持されること

---

### 6.3 グリッド

- **常時表示**（ON/OFF切替なし）
- 参照面・描画面で **同比率**
- 分割数 `N` を設定で変更可能（整数、例：3〜10）
- 縦横ともに `N` 等分

**AC-05**：`N=4` の場合、縦横4等分のグリッドが表示されること

**AC-06**：左右 Canvas でグリッド線の座標が一致すること

---

### 6.4 描画

- ブラシは **ペンのみ**
- 設定可能項目：**線幅（ペンサイズ）**

**AC-07**：ペンサイズ変更が次のストロークに反映されること

---

### 6.5 消しゴム

- 消しゴムモードを持つ
- 描画面の線を削除できる

**AC-08**：消しゴム操作で描画された線が消えること

---

### 6.6 Undo

- **描画操作のみ** Undo 対象
- 以下は Undo 対象外：
  - 画像読み込み
  - グリッド設定変更
  - 表示切替
- Redo は不要

**実装方式（指定）**
- 描画完了ごとに `canvas.toJSON()` を履歴に保存
- Undo 操作で `loadFromJSON()` により復元
- 描画が無い状態で Undo してもエラーにならないこと

**AC-09**：2本描画後、Undo で1本になること

**AC-10**：さらに Undo で0本になること

**AC-11**：描画が無い状態で Undo してもエラーにならないこと

---

## 7. UI要素（論理）

- 画像読み込みボタン
- ペンサイズ調整（Slider）
- 消しゴム切替
- Undo ボタン
- グリッド分割数設定
- 分割表示／重ね表示 切替

※ UI の配置・装飾は仕様外（実装裁量）

---

## 8. 非機能要件（最小）

- 操作に対する反応が体感的に遅延しないこと
- すべてのデータは端末ローカルのみで扱う

---

## 9. 禁止事項（明示）

- 保存／読込機能
- Redo
- レイヤ管理
- 複数ブラシ・高度ブラシ
- 筆圧・傾き対応
- レイアウト切替 UI の追加
- 仕様外の最適化・拡張

---

## 10. 要求アウトプット（Claude向け）

以下を **TypeScript** で、シンプルさ最優先で提示すること。

1. 最小ファイル構成
2. Fabric.js を用いた Canvas 初期化コード
3. グリッド描画ロジック
4. ペンサイズ変更・消しゴム実装
5. Undo（JSON スナップショット方式）
6. Service Worker（最小構成）

---

## 11. 実装上の決定事項

### 11.1 ビルドツール・開発環境
- **Vite** を使用

### 11.2 Canvas の初期サイズ

**最終決定**：**画像サイズベース + 上限制約**

- **初期状態**（画像読み込み前）：Canvas は非表示
- **画像読み込み時**：画像サイズに合わせて Canvas をリサイズ
- **上限サイズ**：**800x800px** (1 Canvas あたり)
  - 画像がこれを超える場合、縦横比を保ったまま 800x800 に収まるよう縮小
  - 参照画像自体を縮小してから Canvas に配置
  - 左右の Canvas は同一サイズ
- **小サイズ画像**：対応スコープ外（そのままのサイズで表示）

**実装難易度**：低

**具体例**：
```
元画像 4000x3000px → 800x600px に縮小 → Canvas も 800x600px
元画像 600x400px   → そのまま 600x400px → Canvas も 600x400px
```

### 11.3 UI配置

**最終決定**：**ミニマル構成（下部ツールバーのみ）**

```
┌─────────────────────────────────────────┐
│                  │                      │
│   参照Canvas     │   描画Canvas         │
│                  │                      │
├──────────────────┴──────────────────────┤
│ [画像] [ペン|消し] [●━━] [グリッド:4]   │
│ [分割|重ね] [Undo]                       │
└─────────────────────────────────────────┘
```

**特徴**：
- Canvas 領域を最大化
- すべての UI を下部1段に集約

### 11.4 PWA manifest.json

**現在の設定**：**仮置き（後で差し替え予定）**

```json
{
  "name": "模写アプリ",
  "short_name": "模写",
  "description": "Drawing practice web app",
  "start_url": "/",
  "display": "standalone",
  "orientation": "landscape",
  "background_color": "#ffffff",
  "theme_color": "#2196F3",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

**アイコン**：単色の仮アイコンを実装時に生成

**最終決定**：TODO（後で差し替え）

---

## 12. TODO リスト

- [x] Canvas サイズ方式の最終決定 → **画像サイズベース + 上限800x800px**
- [x] UI配置・レイアウトの最終決定 → **ミニマル構成（下部ツールバーのみ）**
- [ ] PWA manifest（アプリ名、アイコン等）の最終決定 → 後で差し替え

---

## 13. 仕様凍結

- 本 Spec v0.2 は **凍結**
- 実装前に仕様変更が必要な場合は、本ファイルを改訂すること

---

*End of Spec*

